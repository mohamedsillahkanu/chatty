<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>University Student Network</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .app-container {
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 300px;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .sidebar-header h1 {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
        }

        .current-user {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-top: 1rem;
            padding: 0.75rem;
            background: rgba(255,255,255,0.1);
            border-radius: 0.5rem;
        }

        .current-user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            overflow: hidden;
            background: white;
            border: 2px solid white;
        }

        .current-user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .current-user-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: #667eea;
        }

        .current-user-info h3 {
            font-size: 0.9rem;
            margin-bottom: 0.2rem;
        }

        .current-user-info p {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        .nav-tabs {
            display: flex;
            border-bottom: 1px solid #e0e0e0;
        }

        .nav-tab {
            flex: 1;
            padding: 1rem;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: #666;
            transition: all 0.3s;
            position: relative;
        }

        .nav-tab.active {
            color: #667eea;
        }

        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: #667eea;
        }

        .tab-badge {
            background: #ef4444;
            color: white;
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            border-radius: 1rem;
            margin-left: 0.5rem;
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .friend-item, .request-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .friend-item:hover {
            background: #f5f5f5;
        }

        .friend-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            overflow: hidden;
            background: #f0f0f0;
            flex-shrink: 0;
        }

        .friend-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .friend-avatar-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: #667eea;
        }

        .friend-info {
            flex: 1;
        }

        .friend-name {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.2rem;
        }

        .friend-status {
            font-size: 0.75rem;
            color: #999;
        }

        .online-indicator {
            width: 10px;
            height: 10px;
            background: #4ade80;
            border-radius: 50%;
            display: inline-block;
            margin-right: 0.3rem;
        }

        .request-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-accept, .btn-decline {
            padding: 0.4rem 0.8rem;
            border: none;
            border-radius: 0.3rem;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .btn-accept {
            background: #667eea;
            color: white;
        }

        .btn-decline {
            background: #e0e0e0;
            color: #666;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .main-header {
            background: white;
            padding: 1.5rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .main-header h2 {
            font-size: 1.8rem;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .main-header p {
            color: #666;
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
        }

        /* Student Cards Grid */
        .students-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .student-card {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .student-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .student-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            overflow: hidden;
            background: #f0f0f0;
        }

        .student-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .student-avatar-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: #667eea;
        }

        .student-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
            color: #333;
        }

        .student-major {
            color: #667eea;
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
        }

        .student-year {
            color: #999;
            font-size: 0.8rem;
            margin-bottom: 1rem;
        }

        .card-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
        }

        .btn-add-friend, .btn-message, .btn-pending {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-add-friend {
            background: #667eea;
            color: white;
            flex: 1;
        }

        .btn-add-friend:hover {
            background: #5568d3;
        }

        .btn-message {
            background: #4ade80;
            color: white;
            flex: 1;
        }

        .btn-message:hover {
            background: #3bc76d;
        }

        .btn-pending {
            background: #e0e0e0;
            color: #666;
            flex: 1;
            cursor: default;
        }

        /* Chat Window */
        .chat-window {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 1rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            display: none;
            flex-direction: column;
        }

        .chat-window.active {
            display: flex;
        }

        .chat-header {
            padding: 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 1rem 1rem 0 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-header-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .chat-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
            background: white;
        }

        .chat-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .close-chat {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            background: #f9f9f9;
        }

        .chat-message {
            margin-bottom: 1rem;
            display: flex;
            gap: 0.5rem;
        }

        .chat-message.own {
            flex-direction: row-reverse;
        }

        .message-bubble {
            max-width: 70%;
            padding: 0.75rem;
            border-radius: 1rem;
        }

        .chat-message:not(.own) .message-bubble {
            background: white;
            border-bottom-left-radius: 0.2rem;
        }

        .chat-message.own .message-bubble {
            background: #667eea;
            color: white;
            border-bottom-right-radius: 0.2rem;
        }

        .message-time {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-top: 0.3rem;
        }

        .chat-input {
            padding: 1rem;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 0.5rem;
        }

        .chat-input input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #e0e0e0;
            border-radius: 2rem;
            outline: none;
        }

        .chat-input button {
            background: #667eea;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 2rem;
            cursor: pointer;
            font-weight: 500;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #999;
        }

        /* Create Profile Button */
        .create-profile-btn {
            position: fixed;
            bottom: 30px;
            left: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 3rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
            transition: transform 0.3s;
        }

        .create-profile-btn:hover {
            transform: translateY(-3px);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: #333;
        }

        .form-group {
            margin-bottom: 1.2rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #555;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-family: inherit;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .image-upload-area {
            text-align: center;
            margin-bottom: 1rem;
        }

        .image-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            background: #f0f0f0;
            overflow: hidden;
            border: 3px solid #667eea;
        }

        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .upload-btn {
            background: #667eea;
            color: white;
            padding: 0.6rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .btn-submit {
            flex: 1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 0.9rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-cancel {
            flex: 1;
            background: #e0e0e0;
            color: #666;
            border: none;
            padding: 0.9rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .sidebar {
                position: absolute;
                z-index: 100;
                left: -300px;
                transition: left 0.3s;
            }

            .sidebar.mobile-open {
                left: 0;
            }

            .chat-window {
                width: 100%;
                height: 100%;
                bottom: 0;
                right: 0;
                border-radius: 0;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>üéì Campus Connect</h1>
                <div class="current-user" id="currentUserDisplay">
                    <div class="current-user-avatar">
                        <div class="current-user-placeholder">üë§</div>
                    </div>
                    <div class="current-user-info">
                        <h3>Guest</h3>
                        <p>Create your profile</p>
                    </div>
                </div>
            </div>

            <div class="nav-tabs">
                <button class="nav-tab active" data-tab="friends">
                    Friends <span class="tab-badge" id="friendsCount">0</span>
                </button>
                <button class="nav-tab" data-tab="requests">
                    Requests <span class="tab-badge" id="requestsCount">0</span>
                </button>
            </div>

            <div class="sidebar-content">
                <div id="friendsTab">
                    <div class="empty-state">No friends yet. Send some friend requests!</div>
                </div>
                <div id="requestsTab" style="display: none;">
                    <div class="empty-state">No pending requests</div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="main-header">
                <h2>Student Directory</h2>
                <p>Connect with your fellow students</p>
            </div>

            <div class="content-area">
                <div class="students-grid" id="studentsGrid">
                    <div class="empty-state">
                        <h3>Welcome to Campus Connect!</h3>
                        <p>Create your profile to start connecting with students</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Window -->
    <div class="chat-window" id="chatWindow">
        <div class="chat-header">
            <div class="chat-header-info">
                <div class="chat-avatar" id="chatAvatar">
                    <div style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; font-size:1.5rem; color:#667eea; background:white;">üë§</div>
                </div>
                <div>
                    <div style="font-weight: 600;" id="chatName">Student Name</div>
                    <div style="font-size: 0.8rem; opacity: 0.9;">Online</div>
                </div>
            </div>
            <button class="close-chat" id="closeChat">√ó</button>
        </div>
        <div class="chat-messages" id="chatMessages"></div>
        <div class="chat-input">
            <input type="text" id="chatInput" placeholder="Type a message...">
            <button id="sendMessage">Send</button>
        </div>
    </div>

    <!-- Create Profile Button -->
    <button class="create-profile-btn" id="createProfileBtn">+ Create Profile</button>

    <!-- Create Profile Modal -->
    <div class="modal" id="profileModal">
        <div class="modal-content">
            <h2 class="modal-header">Create Your Profile</h2>
            <form id="profileForm">
                <div class="image-upload-area">
                    <div class="image-preview" id="imagePreview">
                        <div style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; font-size:3rem; color:#ccc;">üì∑</div>
                    </div>
                    <input type="file" id="profilePicture" accept="image/*" style="display:none;">
                    <button type="button" class="upload-btn" onclick="document.getElementById('profilePicture').click()">Upload Photo</button>
                </div>

                <div class="form-group">
                    <label>Full Name *</label>
                    <input type="text" id="fullName" required>
                </div>

                <div class="form-group">
                    <label>Student ID *</label>
                    <input type="text" id="studentId" required>
                </div>

                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" id="email" required>
                </div>

                <div class="form-group">
                    <label>Major *</label>
                    <select id="major" required>
                        <option value="">Select major</option>
                        <option>Computer Science</option>
                        <option>Engineering</option>
                        <option>Business</option>
                        <option>Medicine</option>
                        <option>Law</option>
                        <option>Arts</option>
                        <option>Psychology</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Year *</label>
                    <select id="year" required>
                        <option value="">Select year</option>
                        <option>Freshman</option>
                        <option>Sophomore</option>
                        <option>Junior</option>
                        <option>Senior</option>
                        <option>Graduate</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Bio</label>
                    <textarea id="bio" placeholder="Tell us about yourself..."></textarea>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-cancel" id="cancelProfile">Cancel</button>
                    <button type="submit" class="btn-submit">Create Profile</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // App State
        let currentUser = null;
        let students = [];
        let friendRequests = [];
        let friends = [];
        let chats = {};
        let currentChatUser = null;
        let currentImageData = null;

        // DOM Elements
        const profileModal = document.getElementById('profileModal');
        const createProfileBtn = document.getElementById('createProfileBtn');
        const profileForm = document.getElementById('profileForm');
        const studentsGrid = document.getElementById('studentsGrid');
        const chatWindow = document.getElementById('chatWindow');
        const closeChat = document.getElementById('closeChat');
        const sendMessage = document.getElementById('sendMessage');
        const chatInput = document.getElementById('chatInput');
        const friendsTab = document.getElementById('friendsTab');
        const requestsTab = document.getElementById('requestsTab');

        // Event Listeners
        createProfileBtn.addEventListener('click', () => {
            profileModal.classList.add('active');
        });

        document.getElementById('cancelProfile').addEventListener('click', () => {
            profileModal.classList.remove('active');
        });

        document.getElementById('profilePicture').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    currentImageData = event.target.result;
                    document.getElementById('imagePreview').innerHTML = `<img src="${currentImageData}" alt="Preview">`;
                };
                reader.readAsDataURL(file);
            }
        });

        profileForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const student = {
                id: Date.now(),
                fullName: document.getElementById('fullName').value,
                studentId: document.getElementById('studentId').value,
                email: document.getElementById('email').value,
                major: document.getElementById('major').value,
                year: document.getElementById('year').value,
                bio: document.getElementById('bio').value,
                image: currentImageData
            };

            currentUser = student;
            students.push(student);
            
            profileModal.classList.remove('active');
            profileForm.reset();
            currentImageData = null;
            document.getElementById('imagePreview').innerHTML = '<div style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; font-size:3rem; color:#ccc;">üì∑</div>';
            
            createProfileBtn.style.display = 'none';
            updateCurrentUserDisplay();
            renderStudents();
            
            alert('Profile created successfully! üéâ');
        });

        // Tab switching
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                const tabName = this.dataset.tab;
                if (tabName === 'friends') {
                    friendsTab.style.display = 'block';
                    requestsTab.style.display = 'none';
                } else {
                    friendsTab.style.display = 'none';
                    requestsTab.style.display = 'block';
                }
            });
        });

        closeChat.addEventListener('click', () => {
            chatWindow.classList.remove('active');
        });

        sendMessage.addEventListener('click', sendChatMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendChatMessage();
        });

        // Functions
        function updateCurrentUserDisplay() {
            if (!currentUser) return;
            
            const display = `
                <div class="current-user-avatar">
                    ${currentUser.image 
                        ? `<img src="${currentUser.image}" alt="${currentUser.fullName}">` 
                        : '<div class="current-user-placeholder">üë§</div>'}
                </div>
                <div class="current-user-info">
                    <h3>${currentUser.fullName}</h3>
                    <p>${currentUser.major}</p>
                </div>
            `;
            document.getElementById('currentUserDisplay').innerHTML = display;
        }

        function renderStudents() {
            if (students.length === 0) {
                studentsGrid.innerHTML = '<div class="empty-state"><h3>No students yet</h3><p>Be the first to create a profile!</p></div>';
                return;
            }

            studentsGrid.innerHTML = students.map(student => {
                if (currentUser && student.id === currentUser.id) return '';
                
                const isFriend = friends.some(f => f.id === student.id);
                const isPending = friendRequests.some(r => r.to === student.id && r.from === currentUser?.id);
                
                return `
                    <div class="student-card">
                        <div class="student-avatar">
                            ${student.image 
                                ? `<img src="${student.image}" alt="${student.fullName}">` 
                                : '<div class="student-avatar-placeholder">üë§</div>'}
                        </div>
                        <div class="student-name">${student.fullName}</div>
                        <div class="student-major">${student.major}</div>
                        <div class="student-year">${student.year}</div>
                        ${student.bio ? `<p style="font-size:0.85rem; color:#666; margin-bottom:1rem;">${student.bio}</p>` : ''}
                        <div class="card-actions">
                            ${!currentUser ? '' : 
                                isFriend 
                                    ? `<button class="btn-message" onclick="openChat(${student.id})">üí¨ Message</button>`
                                    : isPending
                                        ? `<button class="btn-pending">‚è≥ Pending</button>`
                                        : `<button class="btn-add-friend" onclick="sendFriendRequest(${student.id})">‚ûï Add Friend</button>`
                            }
                        </div>
                    </div>
                `;
            }).join('');
        }

        function sendFriendRequest(studentId) {
            if (!currentUser) {
                alert('Please create your profile first!');
                return;
            }

            const request = {
                id: Date.now(),
                from: currentUser.id,
                to: studentId,
                fromUser: currentUser
            };

            friendRequests.push(request);
            renderStudents();
            updateRequestsCount();
            alert('Friend request sent! üéâ');
        }

        function acceptFriendRequest(requestId) {
            const request = friendRequests.find(r => r.id === requestId);
            if (request) {
                const friend = students.find(s => s.id === request.from);
                if (friend) {
                    friends.push(friend);
                    friendRequests = friendRequests.filter(r => r.id !== requestId);
                    renderFriends();
                    renderRequests();
                    renderStudents();
                    updateCounts();
                }
            }
        }

        function declineFriendRequest(requestId) {
            friendRequests = friendRequests.filter(r => r.id !== requestId);
            renderRequests();
            updateRequestsCount();
        }

        function renderFriends() {
            if (friends.length === 0) {
                friendsTab.innerHTML = '<div class="empty-state">No friends yet. Send some friend requests!</div>';
                return;
            }

            friendsTab.innerHTML = friends.map(friend => `
                <div class="friend-item" onclick="openChat(${friend.id})">
                    <div class="friend-avatar">
                        ${friend.image 
                            ? `<img src="${friend.image}" alt="${friend.fullName}">` 
                            : '<div class="friend-avatar-placeholder">üë§</div>'}
                    </div>
                    <div class="friend-info">
                        <div class="friend-name">${friend.fullName}</div>
                        <div class="friend-status"><span class="online-indicator"></span>Online</div>
                    </div>
                </div>
            `).join('');
        }

        function renderRequests() {
            const myRequests = friendRequests.filter(r => r.to === currentUser?.id);
            
            if (myRequests.length === 0) {
                requestsTab.innerHTML = '<div class="empty-state">No pending requests</div>';
                return;
            }

            requestsTab.innerHTML = myRequests.map(request => `
                <div class="request-item">
                    <div class="friend-avatar">
                        ${request.fromUser.image 
                            ? `<img src="${request.fromUser.image}" alt="${request.fromUser.fullName}">` 
                            : '<div class="friend-avatar-placeholder">üë§</div>'}
                    </div>
                    <div class="friend-info">
                        <div class="friend-name">${request.fromUser.fullName}</div>
                        <div class="friend-status">${request.fromUser.major}</div>
                    </div>
                    <div class="request-actions">
                        <button class="btn-accept" onclick="acceptFriendRequest(${request.id})">‚úì</button>
                        <button class="btn-decline" onclick="declineFriendRequest(${request.id})">‚úï</button>
                    </div>
                </div>
            `).join('');
        }

        function updateCounts() {
            document.getElementById('friendsCount').textContent = friends.length;
            updateRequestsCount();
        }

        function updateRequestsCount() {
            const myRequests = friendRequests.filter(r => r.to === currentUser?.id);
            document.getElementById('requestsCount').textContent = myRequests.length;
        }

        function openChat(studentId) {
            const student = students.find(s => s.id === studentId);
            if (!student) return;

            currentChatUser = student;
            
            document.getElementById('chatName').textContent = student.fullName;
            document.getElementById('chatAvatar').innerHTML = student.image 
                ? `<img src="${student.image}" alt="${student.fullName}">` 
                : '<div style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; font-size:1.5rem; color:#667eea; background:white;">üë§</div>';
            
            if (!chats[studentId]) {
                chats[studentId] = [];
            }
            
            renderChatMessages(studentId);
            chatWindow.classList.add('active');
        }

        function renderChatMessages(studentId) {
            const messages = chats[studentId] || [];
            const chatMessages = document.getElementById('chatMessages');
            
            if (messages.length === 0) {
                chatMessages.innerHTML = '<div class="empty-state">No messages yet. Start the conversation!</div>';
                return;
            }

            chatMessages.innerHTML = messages.map(msg => `
                <div class="chat-message ${msg.fromCurrentUser ? 'own' : ''}">
                    <div class="message-bubble">
                        <div>${msg.text}</div>
                        <div class="message-time">${msg.time}</div>
                    </div>
                </div>
            `).join('');
            
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function sendChatMessage() {
            const text = chatInput.value.trim();
            if (!text || !currentChatUser) return;

            const message = {
                text: text,
                time: new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }),
                fromCurrentUser: true
            };

            if (!chats[currentChatUser.id]) {
                chats[currentChatUser.id] = [];
            }

            chats[currentChatUser.id].push(message);
            renderChatMessages(currentChatUser.id);
            chatInput.value = '';

            // Simulate response
            setTimeout(() => {
                const response = {
                    text: getRandomResponse(),
                    time: new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }),
                    fromCurrentUser: false
                };
                chats[currentChatUser.id].push(response);
                renderChatMessages(currentChatUser.id);
            }, 1000);
        }

        function getRandomResponse() {
            const responses = [
                "Hey! Thanks for the message üòä",
                "That sounds great!",
                "I'd love to chat more about this!",
                "Absolutely! When are you free?",
                "Nice to hear from you!",
                "Sounds good to me!",
                "Let's meet up sometime!",
                "That's awesome! Tell me more.",
                "I'm doing well, how about you?",
                "Sure thing! Count me in."
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        // Initialize
        renderStudents();
    </script>
</body>
</html>
